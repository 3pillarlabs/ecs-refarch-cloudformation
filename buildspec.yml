version: 0.2

env:
  variables:
    # This S3 stores the ECS Reference Architecture CloudFormation templates
    # so that they can be deployed via a button on the project GitHub README
    S3_BUCKET: "ecs-refarch-cloudformation"

phases:

  pre_build: 
    commands:

      # Validate all of the CloudFormation templates
      - export ERROR_COUNT=0; for TEMPLATE in $(find . | grep yaml); do ERRORS=$(aws cloudformation validate-template --template-body file://$TEMPLATE 2>&1 >/dev/null); if [ "$?" -gt "0" ]; then echo "$TEMPLATE: $ERRORS"; ((ERROR_COUNT++)); fi; done; echo "$ERROR_COUNT template validation error(s) found"; if [ "$ERROR_COUNT" -gt 0 ]; then exit 1; fi

  build:
    commands:

      # Sync the templates
      # - aws s3 sync . s3://ecs-refarch-cloudformation

